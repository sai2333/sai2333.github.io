<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一粒尘埃的发声</title>
    <meta name="description" content="我思故我在">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.2a8ad169.css" as="style"><link rel="preload" href="/assets/js/app.a65f1212.js" as="script"><link rel="preload" href="/assets/js/2.622ffd28.js" as="script"><link rel="preload" href="/assets/js/9.d6f7bd94.js" as="script"><link rel="prefetch" href="/assets/js/10.fdd73572.js"><link rel="prefetch" href="/assets/js/3.47c6a564.js"><link rel="prefetch" href="/assets/js/4.7a4d83b2.js"><link rel="prefetch" href="/assets/js/5.620c1168.js"><link rel="prefetch" href="/assets/js/6.35d42ae5.js"><link rel="prefetch" href="/assets/js/7.66a1a2b2.js"><link rel="prefetch" href="/assets/js/8.e9e47f15.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2a8ad169.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/test.png" alt="一粒尘埃的发声" class="logo"> <span class="site-name can-hide">一粒尘埃的发声</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/weapp/" class="nav-link router-link-active">
  小程序
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/weapp/" class="nav-link router-link-active">
  小程序
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weapp/editImg.html#功能介绍" class="sidebar-link">功能介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weapp/editImg.html#_1-点击替换图片" class="sidebar-link">1. 点击替换图片</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>组件名： <strong>editImg.vue</strong>
功能：可以点击替换图片，触摸移动，缩放。</p> <h2 id="功能介绍"><a href="#功能介绍" class="header-anchor">#</a> 功能介绍</h2> <h3 id="_1-点击替换图片"><a href="#_1-点击替换图片" class="header-anchor">#</a> 1. 点击替换图片</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">_tap</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//当前的图片未选中，点击后显示选中状态</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">!==</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:active&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastCurrent <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastCurrent<span class="token punctuation">]</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastCurrent <span class="token operator">=</span> index<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//更改提示文字</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>round<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:tipsText&quot;</span><span class="token punctuation">,</span><span class="token string">'点击更换头像'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:tipsText&quot;</span><span class="token punctuation">,</span><span class="token string">'点击更换二维码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:tipsText&quot;</span><span class="token punctuation">,</span><span class="token string">'点击更换图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tipsHandle</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="tap事件"><a href="#tap事件" class="header-anchor">#</a> tap事件</h4> <ul><li>通过props.active表示被选中的元素。</li> <li>用户点击图片元素，记录被点击的元素位置。</li> <li>如果点击的不是被选中的元素，那么更新active，当前元素current加1，并且把上一个记录着的元素current属性归0。</li> <li>如果点击的是被选中的元素，则执行替换图片函数</li></ul> <h4 id="touchstart事件"><a href="#touchstart事件" class="header-anchor">#</a> touchStart事件</h4> <ul><li>记录手指触摸的位置（这个位置是相对于canvasWrap，而不是屏幕的）</li></ul> <h4 id="touchmove事件"><a href="#touchmove事件" class="header-anchor">#</a> touchMove事件</h4> <ul><li>是否可以移动的条件，取决于：当前页面是不是自定义页面和当前元素是不是被选中</li> <li>获取当前第一个手指的位置（x,y轴）</li> <li>移动后的位置为：当前的图片位置 + （当前的手指位置 - 上一次记录的位置）</li> <li>通知父组件更新border-box的位置</li> <li>记录图片的imgCenter(用于缩放的坐标)</li> <li>记录触摸结束后的手指位置</li></ul> <h4 id="icontouchstart"><a href="#icontouchstart" class="header-anchor">#</a> _iconTouchStart</h4> <p>在icon上，是通过两指缩放的原理来进行缩放的。比如说，上面的imgCenter坐标，实际上就是一只手指在上面的，另外一只手指在icon，通过这两个坐标的距离来计算要缩放的倍数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recordPreTouchPosition</span><span class="token punctuation">(</span>touches<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
item<span class="token punctuation">.</span>preTouchesClientx1y1x2y2 <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">.</span>imgCenter<span class="token punctuation">.</span>x<span class="token punctuation">,</span>item<span class="token punctuation">.</span>imgCenter<span class="token punctuation">.</span>y<span class="token punctuation">,</span>touches<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>touches<span class="token punctuation">.</span>clientY<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>记录双指位置。</li></ul> <h4 id="icontouchmove"><a href="#icontouchmove" class="header-anchor">#</a> _iconTouchMove</h4> <p>缩放公式： 缩放倍率 = 当前的双指距离 / 上次的双指距离 * 上次的缩放倍率
双指距离可以使用勾股定理公式计算。</p> <ul><li>计算当前滑动后的缩放倍率</li> <li>通知父组件更新border-box的缩放倍率</li> <li>记录双指位置</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a65f1212.js" defer></script><script src="/assets/js/2.622ffd28.js" defer></script><script src="/assets/js/9.d6f7bd94.js" defer></script>
  </body>
</html>
